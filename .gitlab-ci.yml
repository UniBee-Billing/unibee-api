# This template uses jdk8 for verifying and deploying images
image: maven:3.6.3-jdk-8-slim

stages:
  - go-build
  - docker

package-build:
  only:
    - main
  stage: package
  script:
    - echo 'hello package build'

docker-build:
  only:
    - main
  stage: docker
  script:
    - echo 'hello docker build'

golang-build:
  only:
    - main
  stage: go-build
  image: golang # 利用Golang容器进行打包Golang项目
  tags:
    - golang
  script:
    - go env -w GOPROXY=https://goproxy.cn,direct
    - go env -w GOPRIVATE='gitlab.hknet-inc.com'
    - go get
    - GOOS=linux GOARCH=amd64 go build -o temp/linux_amd64/main main.go
    - chmod +x app
